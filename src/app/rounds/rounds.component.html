<mat-card class="main-card" *ngIf="participantsService.unlocked | async">
  <mat-card-header>
    <mat-card-title>Participants not locked</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p>In order to start the first round, you have to lock the participants. Once started, the participants can only be edited by resetting the competion.</p>
  </mat-card-content>
  <mat-card-actions align="end">
    <a mat-raised-button color="primary" class="flex-auto" type="button" routerLink="../participants">Show participants</a>
  </mat-card-actions>
</mat-card>

<ng-container *ngFor="let round of (roundsService.rounds | async); trackBy: id">
  <mat-card class="main-card" *ngIf="round.state === 'EVALUATED'">
    <mat-card-header>
      <mat-card-title>Evaluated round: #{{round.number + 1}}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <app-evaluated-round #evaluatedRounds [round]="round"></app-evaluated-round>
    </mat-card-content>
    <mat-card-actions align="end">
      <button type="button" class="flex-auto" mat-raised-button color="primary"
              (click)="roundsService.nextRound(evaluatedRounds.forStorage()).subscribe()"
              [disabled]="evaluatedRounds.invalid">Prepare next round</button>
    </mat-card-actions>
  </mat-card>

  <mat-card class="main-card" *ngIf="round.state === 'STARTED'">
    <mat-card-header>
      <mat-card-title>Current round: #{{round.number + 1}}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <app-started-round-component #startedRounds [round]="round"></app-started-round-component>
    </mat-card-content>
    <mat-card-actions align="end">
      <button type="button" class="flex-auto" mat-raised-button color="primary"
              (click)="roundsService.evaluateRound(startedRounds.forStorage()).subscribe()"
              [disabled]="startedRounds.invalid">Evaluate round
      </button>
    </mat-card-actions>
  </mat-card>

  <mat-card class="main-card" *ngIf="round.state === 'DRAFT'">
    <mat-card-header>
      <mat-card-title>Next round: #{{round.number + 1}}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <app-draft-round-component #draftRounds [round]="round"></app-draft-round-component>
    </mat-card-content>
    <mat-card-actions align="end">
      <button type="button" class="flex-auto" mat-raised-button color="primary"
              (click)="roundsService.suggestDraw(draftRounds.heatSizes).subscribe()"
              [disabled]="draftRounds.invalid">Suggest new draw
      </button>
      <button type="button" class="flex-auto" mat-raised-button color="primary"
              (click)="roundsService.startRound().subscribe()"
              [disabled]="round.heats.length === 0">Start round
      </button>
    </mat-card-actions>
  </mat-card>
</ng-container>

<mat-card class="main-card" *ngIf="participantsService.locked | async">
  <mat-card-content>
    <p>You can reset the rounds to unlock the participants. However, all rounds so far will be lost and will have to be
      re-danced.</p>
  </mat-card-content>
  <mat-card-actions align="end">
    <a mat-raised-button color="primary" class="flex-auto" type="button"
       (click)="participantsService.unlock().subscribe()">Reset rounds</a>
  </mat-card-actions>

</mat-card>
